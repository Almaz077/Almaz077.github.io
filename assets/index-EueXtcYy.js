import{r as d,j as s}from"./index-Be2Hz3rG.js";import{B as y}from"./Button-DhdhBf4j.js";import{I}from"./Input-B6dY_7nE.js";import{T as P}from"./Table-DixblasI.js";import{M as R}from"./Modal-BAtl_cT8.js";import{k as M,n as F}from"./helpers-DLOf70Zj.js";import{u as B}from"./store-D6J7udoj.js";import{C as D}from"./CheckBox-pn17yu53.js";import{s as W}from"./shallow-Bm4ufq9Z.js";const K=({id:x,value:N})=>{const[h,b]=M(a=>[a.nodes,a.updateNodes]),o=d.useMemo(()=>h.find(a=>a.id===x),[h]);if(!o)return s.jsx("div",{children:"узел не найден"});const m=a=>{const u={...o,data:{...o==null?void 0:o.data,name:a}},j=h.map(v=>v.id===u.id?u:v);b(j)};return s.jsx(I,{value:N,onChange:a=>m(a.target.value)})},k={led1:0,led2:0,led3:0,blOn:0,blOff:0,sms:0,smsWeb:0},O=["id","name"],V=()=>{const{smsText:x,setSms:N,smsWebText:h,setSmsWeb:b,indications:o,setIndications:m,phoneNumber:a,setPhoneNumber:u}=B(e=>({indications:e.indications,setIndications:e.setIndications,smsText:e.smsText,setSms:e.setSms,smsWebText:e.smsWebText,setSmsWeb:e.setSmsWeb,phoneNumber:e.phoneNumber,setPhoneNumber:e.setPhoneNumber}),W),j=M(e=>e.nodes,W);d.useEffect(()=>{const n=j.filter(t=>{var r,S;return(S=(r=t==null?void 0:t.data)==null?void 0:r.type)==null?void 0:S.toLowerCase().includes("output")}).reduce((t,r)=>(t[r.id]={...o[r.id]??k,id:r.id,name:r.data.name??""},t),{});m(n)},[j]);const v=d.useMemo(()=>Object.values(o),[o]),_=(e,n)=>{const t=o[e],r=Object.entries(o).find(([S,w])=>w[n]===1);r&&r[0]!==e||m({...o,[e]:{...t,[n]:t[n]?0:1}})},l=(e,n,t)=>{e.stopPropagation(),!O.includes(t)&&_(n,t)},f=d.useMemo(()=>F({id:"",name:"",...k}),[]);return{renderHead:()=>f.map(e=>s.jsx("th",{children:e},e)),renderRow:e=>s.jsx(s.Fragment,{children:f.map(n=>{const t=!O.includes(n);return s.jsx("td",{onClick:t?r=>l(r,e.id,n):void 0,style:{cursor:t?"pointer":"default"},children:n==="name"?s.jsx(K,{value:e.name,id:e.id}):t?s.jsx(D,{checked:!!e[n]}):e[n]},n)})}),rows:v,smsText:x,setSms:N,smsWebText:h,setSmsWeb:b,phoneNumber:a,setPhoneNumber:u}},A="_content_y9eit_11",H="_title_y9eit_17",c={"btns-row":"_btns-row_y9eit_1",content:A,title:H,"controlled-block":"_controlled-block_y9eit_23","input-row":"_input-row_y9eit_35","input-label":"_input-label_y9eit_43","error-text":"_error-text_y9eit_53"},E=x=>/^\+?\d{10,15}$/.test(x),L=()=>{const{renderHead:x,renderRow:N,rows:h,smsText:b,setSms:o,smsWebText:m,setSmsWeb:a,phoneNumber:u,setPhoneNumber:j}=V(),[v,_]=d.useState(!1),[l,f]=d.useState("sms"),[p,C]=d.useState({sms:{title:"СМС",value:b},smsWeb:{title:"СМС для веба",value:m},phoneNumber:u}),[e,n]=d.useState(!0);d.useEffect(()=>{C({sms:{title:"СМС",value:b},smsWeb:{title:"СМС для веба",value:m},phoneNumber:u})},[b,m,u]);const t=(i,g)=>{C(T=>({...T,[i]:{...T[i],value:g}}))},r=i=>{C(g=>({...g,phoneNumber:i})),n(E(i))},S=()=>{const{value:i}=p[l],g=p.phoneNumber;l==="sms"?(o(i),j(g)):a(i),_(!1)},w=l==="sms"&&!E(p.phoneNumber);return s.jsxs("div",{children:[s.jsx(P,{renderRow:N,renderHead:x,rowItems:h,getRowKey:i=>i.id,maxWidth:1100}),s.jsxs("div",{className:c["btns-row"],children:[s.jsx(y,{text:"смс",onClick:()=>{_(!0),f("sms")}}),s.jsx(y,{text:"смс для веба",onClick:()=>{_(!0),f("smsWeb")}})]}),s.jsx(R,{visible:v,setVisible:_,children:s.jsxs("div",{className:c.content,children:[s.jsx("h2",{className:c.title,children:p[l].title}),s.jsxs("div",{className:c["controlled-block"],children:[s.jsxs("div",{className:c["input-row"],children:[s.jsx("label",{className:c["input-label"],children:"Сообщение"}),s.jsx(I,{value:p[l].value,onChange:i=>t(l,i.target.value)})]}),l==="sms"&&s.jsxs("div",{className:c["input-row"],children:[s.jsx("label",{className:c["input-label"],children:"Номер телефона:"}),s.jsx(I,{value:p.phoneNumber,onChange:i=>r(i.target.value),style:{borderColor:e?void 0:"red"}}),!e&&s.jsx("span",{className:c["error-text"],children:"Неверный номер телефона"})]}),s.jsx(y,{text:"Сохранить",onClick:S,disabled:w})]})]})})]})},Z=()=>s.jsx(L,{});export{Z as default};
